#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Tue Feb 21 20:00:21 2023

@author: zacharymckenzie
"""
import numpy as np

from analysis.histdiff import histdiff
from analysis.psthfunctions import time_stamps_to_bins

sub_spikes = np.array([12.423233333333334, 55.237433333333335, 56.070366666666665, 56.0931, 57.0728, 57.17993333333333, 58.13413333333333, 58.382133333333336, 58.5129, 59.093066666666665, 60.719633333333334, 76.4743, 79.39676666666666, 80.2396, 131.33503333333334, 132.36006666666665, 218.3056, 230.13816666666668, 244.4789, 310.5871, 350.0531, 350.2532, 402.27146666666664, 410.54796666666664, 426.4531333333333, 450.3866, 553.7149333333333, 553.8513, 556.997, 685.2510333333333, 690.6607, 690.6609, 690.6610333333333, 690.6612666666666, 690.6614333333333, 690.6615666666667, 690.6616666666666, 690.6618333333333, 690.6620666666666, 690.6622, 690.6624, 690.6625666666666, 736.8369, 813.6124666666667, 961.6658, 961.7676666666666, 1063.6697, 1071.0125333333333, 1071.0957, 1071.2201333333333, 1072.0030666666667, 1072.1422666666667, 1073.1887666666667, 1073.4773333333333, 1073.4864333333333, 1074.231, 1074.5003666666667, 1155.8949666666667, 1156.2554666666667, 1239.4539666666667, 1270.8348, 1369.9194666666667, 1387.6016333333334, 1608.2340666666666, 1682.651, 1726.1811, 1776.1426, 1791.6964333333333, 1795.5028666666667, 1796.8015666666668, 1798.0476666666666, 1798.1312333333333, 1800.0047, 1800.3628, 1800.3630333333333, 1800.3632, 1801.1866, 1803.9175, 1806.0096666666666, 1852.3786, 1876.5346333333334, 1876.7955666666667, 1876.8764, 1876.9726, 1876.9867666666667, 1878.0169, 1878.2534666666666, 1878.2934, 1878.6960333333334, 1878.7011, 1878.7135, 1878.7573666666667, 1878.9642666666666, 1879.0156666666667, 1879.9541666666667, 1880.0032666666666, 1880.1753333333334, 1880.2625666666668, 1880.3422666666668, 1880.5039666666667, 1880.9871333333333, 1903.8463666666667, 1925.0844, 1933.0269333333333, 1961.0533, 2010.996, 2011.3799333333334, 2032.3287333333333, 2037.1509333333333, 2041.8034, 2055.9137333333333, 2082.203933333333, 2087.1477, 2088.1886666666664, 2089.8541333333333, 2108.2757, 2117.1763333333333, 2120.1682333333333, 2149.3793, 2149.5783333333334, 2150.0941666666668, 2253.8757, 2271.8767333333335, 2277.5826, 2277.7798, 2277.930066666667, 2278.0307666666668, 2279.5296333333335, 2280.2968666666666, 2280.5145666666667, 2280.5642666666668])
events = np.array([60.269666666666666, 90.28976666666667, 120.16923333333334, 150.9389, 180.48856666666666, 210.39813333333333, 300.2771666666667, 330.20666666666665, 360.2162333333333, 390.29586666666665, 420.4956666666667, 450.31516666666664, 539.9441333333333, 569.9334333333334, 600.1832666666667, 630.3428666666666, 660.2926, 690.3921333333333, 780.2309666666666, 810.3307333333333, 840.3700666666666, 870.2099666666667, 900.3094, 926.3492333333334, 1320.5440666666666, 1350.1236666666666, 1380.4333666666666, 1410.2628333333334, 1440.3024666666668, 1470.3421333333333, 1560.041, 1590.3503, 1620.2304, 1650.3500666666666, 1680.2396333333334, 1710.1292, 1799.7084, 1830.4476, 1860.2770666666668, 1889.8069666666668, 1920.2163666666668, 1950.2462666666668, 2040.0150333333333, 2070.1546333333335, 2100.2842, 2130.4837666666667, 2160.1435, 2190.293])
print("Testing histdiff function\n")
bins = np.linspace(.001, 2, num=1000)
counts, centers = histdiff(sub_spikes, sub_spikes, bins)


print(f"Sum of counts is {np.sum(counts)}. It should be 254.0")

assert(int(np.sum(counts))==254)
print(f"Index 50 of centers is {centers[50]}. It should be 0.10205055055055055")

assert(round(centers[50], 4) == 0.1021)
print(f"shape of counts is {np.shape(counts)}. It should be (999,)\n\n")
assert(np.shape(counts) == (999,))

print("Testing time_stamps_to_bins\n")

counts, centers = time_stamps_to_bins(sub_spikes, events, 0.05, 0.0, 10.0)

print(f"Shape of counts is {np.shape(counts)}. It should be (48, 200)")
assert(np.shape(counts) == (48,200))
print(f"the mean of mean counts is {np.mean(np.mean(counts))}. It should be 0.0030208333333333333")
assert(round(np.mean(np.mean(counts)), 3) == 0.003)
print(f"Index 50 of centers is {centers[50]}. It should be 2.5250000000000004\n\n")
assert(round(centers[50], 3) == 2.525)
print("histdiff and time_stamps_to_bins passed check.")